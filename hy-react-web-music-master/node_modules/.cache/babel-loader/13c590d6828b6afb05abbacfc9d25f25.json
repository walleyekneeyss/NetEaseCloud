{"ast":null,"code":"var _jsxFileName = \"/Users/bytedance/Desktop/\\u683C\\u5F0F\\u5316/hy-react-web-music-master/src/pages/player/app-play-bar/index.js\";\nimport React, { memo, useRef, useEffect, useState, useCallback } from 'react';\nimport { useSelector, shallowEqual, useDispatch } from 'react-redux';\nimport { message } from 'antd';\nimport { getPlayUrl, formatMinuteSecond } from '@/utils/format-utils';\nimport { getSongDetailAction, changeCurrentLyricIndexAction, changePlaySequenceAction, changePlaySongAction } from '../store/actionCreators';\nimport HYAppPlayPanel from '../app-play-panel';\nimport { NavLink } from 'react-router-dom';\nimport { Slider } from 'antd';\nimport { PlaybarWrapper, Control, PlayInfo, Operator } from './style';\nexport default memo(function HYAppPlaybar() {\n  // props and state\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [duration, setDuration] = useState(0);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [progress, setProgress] = useState(0);\n  const [isChanging, setIsChanging] = useState(false);\n  const [showPanel, setShowPanel] = useState(false); // redux hooks\n\n  const {\n    currentSong,\n    currentLyrics,\n    currentLyricIndex,\n    playList,\n    playSequence\n  } = useSelector(state => ({\n    currentSong: state.getIn([\"player\", \"currentSong\"]),\n    currentLyrics: state.getIn([\"player\", \"currentLyrics\"]),\n    currentLyricIndex: state.getIn([\"player\", \"currentLyricIndex\"]),\n    playList: state.getIn([\"player\", \"playList\"]),\n    playSequence: state.getIn([\"player\", \"playSequence\"])\n  }), shallowEqual);\n  const dispatch = useDispatch(); // other hooks\n\n  const audioRef = useRef();\n  useEffect(() => {\n    dispatch(getSongDetailAction(167876));\n  }, [dispatch]);\n  useEffect(() => {\n    audioRef.current.src = getPlayUrl(currentSong.id);\n    audioRef.current.play().then(res => {\n      setIsPlaying(true);\n    }).catch(err => {\n      setIsPlaying(false);\n    });\n    setDuration(currentSong.dt);\n  }, [currentSong]); // 其他业务\n\n  const play = useCallback(() => {\n    setIsPlaying(!isPlaying);\n    isPlaying ? audioRef.current.pause() : audioRef.current.play().catch(err => {\n      setIsPlaying(false);\n    });\n  }, [isPlaying]);\n\n  const timeUpdate = e => {\n    const currentTime = e.target.currentTime;\n\n    if (!isChanging) {\n      setCurrentTime(currentTime);\n      setProgress(currentTime * 1000 / duration * 100);\n    }\n\n    let lrcLength = currentLyrics.length;\n    let i = 0;\n\n    for (; i < lrcLength; i++) {\n      const lrcTime = currentLyrics[i].time;\n\n      if (currentTime * 1000 < lrcTime) {\n        break;\n      }\n    }\n\n    const finalIndex = i - 1;\n\n    if (finalIndex !== currentLyricIndex) {\n      dispatch(changeCurrentLyricIndexAction(finalIndex));\n      message.open({\n        content: currentLyrics[finalIndex].content,\n        key: \"lyric\",\n        duration: 0,\n        className: 'lyric-message'\n      });\n    }\n  };\n\n  const timeEnded = () => {\n    if (playSequence === 2 || playList.length === 1) {\n      audioRef.current.currentTime = 0;\n      audioRef.current.play();\n    } else {\n      dispatch(changePlaySongAction(1));\n    }\n  };\n\n  const sliderChange = useCallback(value => {\n    setProgress(value);\n    const time = value / 100.0 * duration / 1000;\n    setCurrentTime(time);\n    setIsChanging(true);\n  }, [duration]);\n  const sliderAfterChange = useCallback(value => {\n    const time = value / 100.0 * duration / 1000;\n    audioRef.current.currentTime = time;\n    setCurrentTime(time);\n    setIsChanging(false);\n\n    if (!isPlaying) {\n      play();\n    }\n  }, [duration, isPlaying, play]);\n  return /*#__PURE__*/React.createElement(PlaybarWrapper, {\n    className: \"sprite_playbar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content wrap-v2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Control, {\n    isPlaying: isPlaying,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"sprite_playbar btn prev\",\n    onClick: e => dispatch(changePlaySongAction(-1)),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"sprite_playbar btn play\",\n    onClick: e => play(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"sprite_playbar btn next\",\n    onClick: e => dispatch(changePlaySongAction(1)),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(PlayInfo, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"image\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(NavLink, {\n    to: \"/discover/player\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: \"https://p2.music.126.net/OVkXDNmbk2uj6wE1KTZIwQ==/109951165203334337.jpg?param=34y34\",\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"info\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"song\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"song-name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 15\n    }\n  }, currentSong.name), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"singer-name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 15\n    }\n  }, currentSong.ar[0].name)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"progress\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Slider, {\n    value: progress,\n    onChange: sliderChange,\n    onAfterChange: sliderAfterChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"time\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"now-time\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 17\n    }\n  }, formatMinuteSecond(currentTime * 1000)), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"divider\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 17\n    }\n  }, \"/\"), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"total-time\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 17\n    }\n  }, formatMinuteSecond(duration)))))), /*#__PURE__*/React.createElement(Operator, {\n    sequence: playSequence,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"sprite_playbar btn favor\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"sprite_playbar btn share\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"right sprite_playbar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"sprite_playbar btn volume\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"sprite_playbar btn loop\",\n    onClick: e => dispatch(changePlaySequenceAction(playSequence + 1)),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"sprite_playbar btn playlist\",\n    onClick: e => setShowPanel(!showPanel),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 13\n    }\n  }, playList.length)))), /*#__PURE__*/React.createElement(\"audio\", {\n    ref: audioRef,\n    onTimeUpdate: timeUpdate,\n    onEnded: timeEnded,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 7\n    }\n  }), showPanel && /*#__PURE__*/React.createElement(HYAppPlayPanel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 21\n    }\n  }));\n});","map":{"version":3,"sources":["/Users/bytedance/Desktop/格式化/hy-react-web-music-master/src/pages/player/app-play-bar/index.js"],"names":["React","memo","useRef","useEffect","useState","useCallback","useSelector","shallowEqual","useDispatch","message","getPlayUrl","formatMinuteSecond","getSongDetailAction","changeCurrentLyricIndexAction","changePlaySequenceAction","changePlaySongAction","HYAppPlayPanel","NavLink","Slider","PlaybarWrapper","Control","PlayInfo","Operator","HYAppPlaybar","isPlaying","setIsPlaying","duration","setDuration","currentTime","setCurrentTime","progress","setProgress","isChanging","setIsChanging","showPanel","setShowPanel","currentSong","currentLyrics","currentLyricIndex","playList","playSequence","state","getIn","dispatch","audioRef","current","src","id","play","then","res","catch","err","dt","pause","timeUpdate","e","target","lrcLength","length","i","lrcTime","time","finalIndex","open","content","key","className","timeEnded","sliderChange","value","sliderAfterChange","name","ar"],"mappings":"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","sourcesContent":["import React, { memo, useRef, useEffect, useState, useCallback } from 'react';\nimport { useSelector, shallowEqual, useDispatch } from 'react-redux';\n\nimport { message } from 'antd';\n\nimport { getPlayUrl, formatMinuteSecond } from '@/utils/format-utils';\nimport { \n  getSongDetailAction, \n  changeCurrentLyricIndexAction,\n  changePlaySequenceAction,\n  changePlaySongAction \n} from '../store/actionCreators';\n\nimport HYAppPlayPanel from '../app-play-panel'\nimport { NavLink } from 'react-router-dom';\nimport { Slider } from 'antd';\nimport {\n  PlaybarWrapper,\n  Control,\n  PlayInfo,\n  Operator\n} from './style';\n\nexport default memo(function HYAppPlaybar() {\n  // props and state\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [duration, setDuration] = useState(0);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [progress, setProgress] = useState(0);\n  const [isChanging, setIsChanging] = useState(false);\n  const [showPanel, setShowPanel] = useState(false);\n\n  // redux hooks\n  const {\n    currentSong,\n    currentLyrics,\n    currentLyricIndex,\n    playList,\n    playSequence\n  } = useSelector(state => ({\n    currentSong: state.getIn([\"player\", \"currentSong\"]),\n    currentLyrics: state.getIn([\"player\", \"currentLyrics\"]),\n    currentLyricIndex: state.getIn([\"player\", \"currentLyricIndex\"]),\n    playList: state.getIn([\"player\", \"playList\"]),\n    playSequence: state.getIn([\"player\", \"playSequence\"])\n  }), shallowEqual);\n  const dispatch = useDispatch();\n\n  // other hooks\n  const audioRef = useRef();\n  useEffect(() => {\n    dispatch(getSongDetailAction(167876));\n  }, [dispatch]);\n\n  useEffect(() => {\n    audioRef.current.src = getPlayUrl(currentSong.id);\n    audioRef.current.play().then(res => {\n      setIsPlaying(true);\n    }).catch(err => {\n      setIsPlaying(false);\n    });\n    setDuration(currentSong.dt);\n  }, [currentSong]);\n\n  // 其他业务\n  const play = useCallback(() => {\n    setIsPlaying(!isPlaying);\n    isPlaying ? audioRef.current.pause() : audioRef.current.play().catch(err => {\n      setIsPlaying(false);\n    });\n  }, [isPlaying]);\n\n  const timeUpdate = (e) => {\n    const currentTime = e.target.currentTime;\n    if (!isChanging) {\n      setCurrentTime(currentTime);\n      setProgress((currentTime * 1000) / duration * 100);\n    }\n\n    let lrcLength = currentLyrics.length;\n    let i = 0;\n    for (; i < lrcLength; i++) {\n      const lrcTime = currentLyrics[i].time;\n      if (currentTime * 1000 < lrcTime) {\n        break\n      }\n    }\n    const finalIndex = i - 1;\n    if (finalIndex !== currentLyricIndex) {\n      dispatch(changeCurrentLyricIndexAction(finalIndex));\n      message.open({\n        content: currentLyrics[finalIndex].content,\n        key: \"lyric\",\n        duration: 0,\n        className: 'lyric-message',\n      })\n    }\n  }\n\n  const timeEnded = () => {\n    if (playSequence === 2 || playList.length === 1) {\n      audioRef.current.currentTime = 0;\n      audioRef.current.play();\n    } else {\n      dispatch(changePlaySongAction(1));\n    }\n  }\n\n  const sliderChange = useCallback((value) => {\n    setProgress(value);\n    const time = value / 100.0 * duration / 1000;\n    setCurrentTime(time);\n    setIsChanging(true);\n  }, [duration])\n\n  const sliderAfterChange = useCallback((value) => {\n    const time = value / 100.0 * duration / 1000;\n    audioRef.current.currentTime = time;\n    setCurrentTime(time);\n    setIsChanging(false);\n\n    if (!isPlaying) {\n      play();\n    }\n  }, [duration, isPlaying, play]);\n\n  return (\n    <PlaybarWrapper className=\"sprite_playbar\">\n      <div className=\"content wrap-v2\">\n        <Control isPlaying={isPlaying}>\n          <button className=\"sprite_playbar btn prev\" \n                  onClick={e => dispatch(changePlaySongAction(-1))}></button>\n          <button className=\"sprite_playbar btn play\" onClick={e => play()}></button>\n          <button className=\"sprite_playbar btn next\" \n                  onClick={e => dispatch(changePlaySongAction(1))}></button>\n        </Control>\n        <PlayInfo>\n          <div className=\"image\">\n            <NavLink to=\"/discover/player\">\n              <img src=\"https://p2.music.126.net/OVkXDNmbk2uj6wE1KTZIwQ==/109951165203334337.jpg?param=34y34\" alt=\"\" />\n            </NavLink>\n          </div>\n          <div className=\"info\">\n            <div className=\"song\">\n              <span className=\"song-name\">{currentSong.name}</span>\n              <span className=\"singer-name\">{currentSong.ar[0].name}</span>\n            </div>\n            <div className=\"progress\">\n              <Slider value={progress} onChange={sliderChange} onAfterChange={sliderAfterChange} />\n              <div className=\"time\">\n                <span className=\"now-time\">{formatMinuteSecond(currentTime * 1000)}</span>\n                <span className=\"divider\">/</span>\n                <span className=\"total-time\">{formatMinuteSecond(duration)}</span>\n              </div>\n            </div>\n          </div>\n        </PlayInfo>\n        <Operator sequence={playSequence}>\n          <div className=\"left\">\n            <button className=\"sprite_playbar btn favor\"></button>\n            <button className=\"sprite_playbar btn share\"></button>\n          </div>\n          <div className=\"right sprite_playbar\">\n            <button className=\"sprite_playbar btn volume\"></button>\n            <button className=\"sprite_playbar btn loop\" \n                    onClick={e => dispatch(changePlaySequenceAction(playSequence+1))}></button>\n            <button className=\"sprite_playbar btn playlist\" \n                    onClick={e => setShowPanel(!showPanel)}>\n              {playList.length}\n            </button>\n          </div>\n        </Operator>\n      </div>\n      <audio ref={audioRef} onTimeUpdate={timeUpdate} onEnded={timeEnded}/>\n      {showPanel && <HYAppPlayPanel />}\n    </PlaybarWrapper>\n  )\n})\n"]},"metadata":{},"sourceType":"module"}